<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Insights - NYC Taxi Passengers Visualization</title>
  <link rel="stylesheet" href="../insights.css">
</head>
<body>

  <!-- HEADER -->
    <header>
    <div class="logo">
      <a href="/" class="home-link">
        <img src="../../images/projext_logo101_cstmzd.png" alt="NYC Taxi Analytics Logo" class="logo-img" />
      </a>
    </div>
    <nav>
      <a href="index9.html">Home</a>
      <a href="#">Browse</a>
      <a href="insights.html" class="active">Insights</a>
      <a href="data.html">Data</a>
      <i class="fas fa-search"></i>
      <i class="fas fa-cog"></i>
      <i class="fas fa-bars"></i>
    </nav>
  </header>

  <div class="background-overlay"></div>


  <!-- POPUPS -->
  <div class="popup search-popup" id="searchPopup">
    <input type="text" placeholder="Search NYC Taxi Data..." />
    <button>Search</button>
  </div>

  <div class="popup settings-popup" id="settingsPopup">
    <h3>Settings</h3>
    <label><input type="checkbox" /> Dark Mode</label>
    <label><input type="checkbox" /> Enable Animations</label>
  </div>

  <!-- MAIN CONTENT -->
  <main>
    <!-- SIDE PANEL -->
    <aside id="filters">
      <h2>Insights</h2>
      <nav class="side-nav">
        <a href="../nyc-metropolis-taxi-analytics/insights/average_trips.html"><i class="fas fa-chart-line"></i> Average Trips</a>
        <a href="../nyc-metropolis-taxi-analytics/insights/longest_trip.html"><i class="fas fa-route"></i> Longest Trip</a>
        <a href="../nyc-metropolis-taxi-analytics/insights/shortest_trip.html"><i class="fas fa-road"></i> Shortest Trip</a>
        <a href="../nyc-metropolis-taxi-analytics/insights/most_visited.html"><i class="fas fa-map-marker-alt"></i> Most Visited</a>
        <a href="../nyc-metropolis-taxi-analytics/insights/passengers.html"><i class="fas fa-user-friends"></i> Passengers</a>
        <a href="../nyc-metropolis-taxi-analytics/insights/vendors.html"><i class="fas fa-taxi"></i> Vendors</a>
      </nav>
      <a href="/" class="home-link">
        <img src="../../images/projext_logo101_cstmzd.png" alt="Home Logo" class="home-link" /></a>
    </aside>

    <!-- DASHBOARD CONTENT -->

    <section class="info-section light">
      <h1>Passengers Dashboard</h1>
      <p>Here you can see the total number of passengers per NYC taxi dropoff zone, grouped by borough. The stacked bar chart shows the contribution of each zone to the borough’s total passengers.</p>
    </section>

    <section class="info-section dark">
      <h2>Most Passengers by Dropoff Zone (Stacked by Borough)</h2>
      <canvas id="passengersChart"></canvas>
    </section>
  </main>

  <!-- FOOTER -->
  <footer>
    <div class="footer-container">
      <div class="footer-logo">
        <img src="../../images/projext_logo101_cstmzd.png" alt="Footer Logo" class="logo-img" /><br />
        NYC Taxi Data Visualization
        <p>Empowering insights through open mobility data.</p>
      </div>

      <div class="footer-links">
        <h3>Explore</h3>
        <a href="index_II.html">Home</a>
        <a href="#">Browse</a>
        <a href="insights.html">Insights</a>
        <a href="#">Data</a>
      </div>

      <div class="footer-socials">
        <h3>Follow Us</h3>
        <a href="#"><img src="../../icons/icons8-facebook-50.png" alt="Facebook" /></a>
        <a href="#"><img src="../../icons/icons8-twitter-bird-50.png" alt="Twitter" /></a>
        <a href="#"><img src="../../icons/icons8-linkedin-circled-50.png" alt="LinkedIn" /></a>
        <a href="#"><img src="../../icons/icons8-instagram-50.png" alt="Instagram" /></a>
        <a href="#"><img src="../../icons/icons8-youtube-50.png" alt="YouTube" /></a>

        <div class="footer-gps">
          <img src="../../images/GPS-Icon-PNG-Clip-Art-HD-Quality.png" alt="GPS Icon" />
        </div>
      </div>
    </div>

    <div class="footer-bottom">
      <p>© 2025 NYC Metropolis Taxi Analytics | Built for Urban Mobility Insights</p>
    </div>
  </footer>

<button id="scrollTopBtn"><i class="fas fa-arrow-up"></i></button>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const API_BASE = "http://127.0.0.1:8000/api";

  async function renderPassengersChart() {
    try {
      const response = await fetch(`${API_BASE}/visit/most_passengers`);
      const data = await response.json();
      console.log("Fetched passengers data:", data);

      // Group data by DOLocationName (borough)
      const boroughs = [...new Set(data.map(d => d.DOLocationName))];
      const zones = data.map(d => d.Zone);

      // Assign a unique color per borough
      const colors = {};
      const colorPalette = [
        "rgba(54, 162, 235, 0.7)",
        "rgba(255, 99, 132, 0.7)",
        "rgba(255, 206, 86, 0.7)",
        "rgba(75, 192, 192, 0.7)",
        "rgba(153, 102, 255, 0.7)"
      ];
      boroughs.forEach((b, i) => colors[b] = colorPalette[i % colorPalette.length]);

      // Prepare datasets
      const datasets = boroughs.map(borough => {
        return {
          label: borough,
          data: data.map(d => d.DOLocationName === borough ? d.PassangerCount : 0),
          backgroundColor: colors[borough]
        };
      });

      const ctx = document.getElementById("passengersChart").getContext("2d");
      new Chart(ctx, {
        type: "bar",
        data: {
          labels: zones,
          datasets: datasets
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: "top" },
            title: { display: true, text: "NYC Taxi Passengers by Dropoff Zone (Stacked by Borough)" }
          },
          scales: {
            x: { stacked: true },
            y: { stacked: true, beginAtZero: true }
          }
        }
      });

    } catch (error) {
      console.error("Error rendering passengers chart:", error);
    }
  }

  document.addEventListener("DOMContentLoaded", renderPassengersChart);
</script>

</body>
</html>
